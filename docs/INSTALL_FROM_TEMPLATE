Point ec2 tools at libra test:
1) Get the ec2-api-tools: http://aws.amazon.com/developertools/351?_encoding=UTF8&jiveRedirect=1 and unzip to a dir
2) Use/copy the X.509 keys from li source under li/docs/x509 and add to your env:
export EC2_PRIVATE_KEY=~/.aws/libratest/pk-YVICJKJDDLYG2LNKHFV47Z6GO4S5MY4B.pem
export EC2_CERT=~/.aws/libratest/cert-YVICJKJDDLYG2LNKHFV47Z6GO4S5MY4B.pem
3) Add EC2_HOME and JAVA_HOME to your ENV as well
4) Run ec2-describe-images (to prove it works and pick the image you want to instantiate).  You'll need the ami name.

Instantiate and setup the image (starting with an ami name (Ex: ami-f4e3109d)):
1) Run "ec2-run-instances ami-7c5ead15 -t m1.large" and get the instance id from the output (Ex: i-6347070d).  If you need less power you can use t1.micro (~.02 per hour (micro) vs. ~.34 per hour (large)).  We are working to get m1.small working.
2) Run "ec2-describe-instances i-6347070d" and get the external name from the output after the ami id (Ex:  ec2-50-17-87-119.compute-1.amazonaws.com)
3) Copy libra.pem from /li/docs/libra to the current dir and run "chmod 600 libra.pem"
4) In another terminal run on the local machine run "cat .ssh/libra_id_rsa.pub" or pick some other public key you want to use.  Copy just the key between ssh-rsa and the identifier at the end to use in step 7)
5) Log into the new instance with "ssh -i libra.pem root@ec2-50-17-87-119.compute-1.amazonaws.com"
5.1) Run 'yum update'
5.2) Run 'setenforce 0' as a temporary measure while we work out SELinux
controls
6) vi /etc/libra/node.conf and add the lines
unobfuscate=1
limits_nproc=100
7) /usr/bin/rhc-new-user -n <namespace> -l <rhlogin> -s <the key you just copied from 4)>
This should output something like:
{"rhlogin":"<rhlogin>","uuid":"69559fc92d224996bcc38ba19f10ca87"}
Remember this "uuid" as <uuid>.
8) mc-rhc-cartridge-do -v -a configure -n li -l <rhlogin> --cartridge php-5.3.2 -p <password>
9) You can now browse to http://li.<userid>.rhcloud.com/  (should say forbidden)
10) cd ~<uuid>
11) chcon -t ssh_home_t .ssh -R
12) chgrp <uuid> /etc/mcollective/client.cfg

Now back on the client machine:
1) edit ~/.ssh/config and add an entry like:
Host li.<namespace>.rhcloud.com
   User <uuid>
   IdentityFile ~/.ssh/libra_id_rsa
2) Clone the existing repo and update it with the php app as follows
  cd /tmp
  git clone ssh://li.<namespace>.rhcloud.com/var/lib/libra/<uuid>/git/li.git
  cd li
  cp -r <libra>/php .
  git add .
  git commit -a -m "Adding broker app"
  git push
3) From the root of the li repo run cp ./client/client.conf ~/.li
4) edit ~/.li and change "li_server = 'lidemo.mcgrath.rhcloud.com'" to "li_server = 'li.<namespace>.rhcloud.com'"
5) add a line <rhlogin>=<uuid>
6) rhc-create-app -l <rhlogin> -a <appname> -r <app folder> -t php-5.3.2 -b
7) You can now browse to http://<appname>.<namespace>.rhcloud.com/

You can delete an instance with:
ec2-terminate-instances <instance_id>
