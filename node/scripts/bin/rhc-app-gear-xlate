#!/bin/bash

#
# In a particular path (ex: .env), make variable name translations
#

wp="$1"

if [ -z "$wp" ]
then
  echo "ERROR: Working path is not a directory: $wp"
  exit 65  
fi

if ! [ -d "$wp" ]
then 
  echo "ERROR: Working path is not a directory: $wp"
  exit 66
fi  

cd $wp

XLATION=( \
  OPENSHIFT_10GEN_MMS_AGENT_APP_DIR \
  OPENSHIFT_APP_CTL_SCRIPT \
  OPENSHIFT_APP_DIR \
  OPENSHIFT_APP_DNS \
  OPENSHIFT_APP_NAME \
  OPENSHIFT_APP_STATE \
  OPENSHIFT_APP_TYPE \
  OPENSHIFT_METRICS_APP_DIR \
  OPENSHIFT_PHPMOADMIN_APP_DIR \
  OPENSHIFT_PHPMYADMIN_APP_DIR \
  OPENSHIFT_ROCKMONGO_APP_DIR \
  OPENSHIFT_APP_UUID \
 )

for xlate in "${XLATION[@]}"
do
  dst=$(echo "$xlate" | sed -e 's/APP/GEAR/')
  if [ -f "$xlate" -a \! -f "$dst" ]
  then
    sed -e s\|"$xlate"\|"$dst"\|g "$xlate" > "$dst"
    chown root:root "$dst"
    chmod 0644 "$dst"
    chcon --reference="$xlate" "$dst"
    if [ "$xlate" != "OPENSHIFT_APP_UUID" ]; then
      echo 'source $(dirname "$_")/'"$dst" > "$xlate"
      echo "export $xlate=\"\$$dst\"" >> "$xlate"
    fi
  fi
done

exit 0
