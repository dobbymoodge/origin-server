#!/bin/bash

function libra_users() {
    grep ":libra guest:" /etc/passwd | cut -d: -f1
}

days=15
[ -z $1 ] || days=$1

for f in $(libra_users)
do
    APPHOME=/var/lib/stickshift/$f
    if [ -d "$APPHOME" ]; then
        # Is stale detection disabled
        [ -e "${APPHOME}/.disable_stale" ] && continue

        # Determine if something was committed using the git objects directory
        objects_modified=$(find $APPHOME/git -name objects -mtime -$days)
        if [ -z "${objects_modified}" ]; then
            if /usr/bin/rhc-app-idle $f $days
            then
                echo "$f is stale"
            fi
        fi
    fi
done

