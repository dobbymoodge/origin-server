- show_dates = false if show_dates.nil?
- show_details = false if show_details.nil?
- show_payments = false if show_payments.nil?

:css
  table.plan-items .plan-item-cost { text-align: right; }

%table.table.table-striped.plan-items
  - bill.line_items.sort_by(&Aria::LineItem.plan_sort).each do |li|
    %tr.plan-item
      - if show_dates
        %td= li.date
      %td
        = li.name
      - if show_details
        %td.plan-item-rate
          - if li.tax?
            &nbsp;
          - elsif li.usage?
            #{number_with_precision(li.units, :precision => 0)} @ #{number_to_currency(li.rate)} / #{li.units_label}
          - elsif li.recurring?
            - if li.rate
              #{number_to_currency(li.rate)} / month
              - if li.prorated?
                (prorated)
            - elsif li.total_cost < 0
              Service Credit
      %td.plan-item-cost
        = number_to_currency(li.total_cost)

  %tr.plan-total
    %td.right{:colspan => ((show_dates ? 1 : 0) + (show_details ? 1 : 0) + 2)}
      %strong Total charges:&nbsp; #{number_to_currency(bill.estimated_balance)}

  - if show_payments and bill.payments.present?
    %tr.plan-total
      %td{:colspan => ((show_dates ? 1 : 0) + (show_details ? 1 : 0) + 2)}
        - bill.payments.each do |p|
          %div
            = bill.show_payment_amounts ? "#{number_to_currency(p.applied_amount)} billed to" : "Billed to"
            %strong= p.payment_src_description
            - if p.payment_src_suffix
              ending in 
              %strong= p.payment_src_suffix
            - if show_dates
              on
              = p.date.to_datetime.to_s(:billing_date)
            &nbsp; 
            #{link_to "Change card", edit_account_payment_method_path}

