#!/usr/bin/env ruby

require 'rubygems'
require 'json'
require 'pp'

STDOUT.sync = true
STDERR.sync = true

@username = ENV['JENKINS_USERNAME']
@password = ENV['JENKINS_PASSWORD']
@hostname = ENV['JENKINS_URL'].split("/")[-1]

def reload
  status_code = `curl -s -w %{http_code} --output /dev/null -X POST --insecure http://#{@username}:#{@password}@#{@hostname}/reload`
  
  if status_code != '302' && status_code != '200' # returns a 302 but checking 200 just to be safe
    exit 1
  end
end

reload