#!/bin/bash -eux

case "$1" in
  -v|--version)
    version="$2"
esac

echo "export OPENSHIFT_ZEND_VERSION='$version'" > "$OPENSHIFT_ZEND_DIR/env/OPENSHIFT_ZEND_VERSION"

cp -r $OPENSHIFT_ZEND_DIR/versions/$version/template/* $OPENSHIFT_ZEND_DIR/template

# FIXME: delete ~/zend/modules;
# /usr/lib64/httpd/modules/ vs. /usr/local/zend/gui/lighttpd/lib/
ln -s /usr/lib64/httpd/modules $OPENSHIFT_ZEND_DIR/modules
ln -s /etc/httpd/conf/magic $OPENSHIFT_ZEND_DIR/conf/magic

# Pear setup
rm -f $OPENSHIFT_HOMEDIR/.pearrc
pear config-create "$OPENSHIFT_ZEND_DIR"/phplib/pear/ "$OPENSHIFT_HOMEDIR"/.pearrc
pear -c "$OPENSHIFT_HOMEDIR"/.pearrc config-set php_ini "$OPENSHIFT_ZEND_DIR"/versions/shared/configuration/etc/conf/php.ini
pear -c "$OPENSHIFT_HOMEDIR"/.pearrc config-set auto_discover 1