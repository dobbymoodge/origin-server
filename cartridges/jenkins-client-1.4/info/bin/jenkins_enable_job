#!/usr/bin/env ruby

require 'rubygems'
require 'json'
require 'pp'

STDOUT.sync = true
STDERR.sync = true

@username = ENV['JENKINS_USERNAME']
@password = ENV['JENKINS_PASSWORD']
@hostname = ENV['JENKINS_URL'].split("/")[-1]
@job_url = "/job/#{ENV['OPENSHIFT_APP_NAME']}-build"

def enable_job
  status_code = `curl -s -w %{http_code} --output /dev/null -X POST --insecure https://#{@username}:#{@password}@#{@hostname}#{@job_url}/enable`

  if status_code != '302' && status_code != '200' # returns a 302 but checking 200 just to be safe
    exit 1
  end
end

enable_job