mcollective
===========
a framework to build server orchestration or parallel job
    execution systems

Screencasts / demos
===================

People new to mcollective might find the following videos useful. They include
introductions, ec2 demos, message flow, writing agents, simple RPC, etc.

http://www.puppetlabs.com/mcollective/screencasts/

Changes to make mcollective use AES encryption
==============================================
diff of /etc/mcollective/client.cfg

< securityprovider = psk
< plugin.psk = keepsecret
---
> securityprovider = aes_security
> plugin.aes.client_private = /etc/mcollective/ssl/clients/mcollective-private.pem
> plugin.aes.client_public = /etc/mcollective/ssl/clients/mcollective-public.pem
> plugin.aes.send_pubkey = 1
> plugin.aes.learn_pubkeys = 1

diff of /etc/mcollective/server.cfg

< securityprovider = psk
< plugin.psk = keepsecret
---
> securityprovider = aes_security
> plugin.aes.server_private = /var/lib/puppet/ssl/private_keys/localhost.localdomain.pem
> plugin.aes.server_public = /var/lib/puppet/ssl/public_keys/localhost.localdomain.pem
> plugin.aes.client_cert_dir = /etc/mcollective/ssl/clients
> plugin.aes.send_pubkey = 1
> plugin.aes.learn_pubkeys = 1

* In devenv there is no puppet servers so the keys are baked into the rh-devenv rpm.  In prod, they should not be needed.
** in the rh-devenv rpm, the client certs are created in /etc/mcollective/ssl/clients
*** When dropping in production you need to adjust the /etc/qpidd.conf file and add the qpid ports in iptables.  It works with the stock selinux policy.  You will also need to make-certs.sh and copy them around.

==========================================================================

SPIN UP TWO DEVENV INSTANCES
* On one instance (this will be the broker):

vi /etc/mcollective/client.cfg
Modify
plugin.amqp.host = ip-10-10-10-10.ec2.internal
to the hostname of the other instance

vi /etc/mcollective/server.cfg
Modify
plugin.amqp.host = ip-10-10-10-10.ec2.internal
to the hostname of the other instance

vi /etc/qpidd.conf
Modify
ssl-cert-name=ip-10-10-10-10.ec2.internal
to the hostname of the other instance

cd /etc/stickshift/devenv/qpid/
vi make-certs.sh
Modify
server_id="ip-10-10-10-10.ec2.internal"
owner_domain_name="ip-10-10-10-10.ec2.internal"
to the hostname of the other instance

./make-certs.sh
/bin/cp test/client_db/* /etc/qpid/pki/client_db/
/bin/cp test/server_db/* /etc/qpid/pki/server_db/
restorecon -R /etc/qpid/pki/
chmod +r /etc/qpid/pki/client_db/* /etc/qpid/pki/server_db/*
service qpidd restart
service mcollective restart


* Then on your local system run:

Assumes you have your broker instance as 'verifier2' and server instance as 'verifier'
cd /tmp
rm -rf /tmp/test
scp -r verifier2:/etc/stickshift/devenv/qpid/test/ .
scp -r test/client_db/* verifier:/etc/qpid/pki/client_db/
scp -r test/server_db/* verifier:/etc/qpid/pki/server_db/

rm -rf /tmp/clients
scp -r verifier2:/etc/mcollective/ssl/clients/ .
scp -r clients/* verifier:/etc/mcollective/ssl/clients/

* Now on the other instance (this will be the server):

vi /etc/mcollective/server.cfg
Modify
plugin.amqp.host = ip-10-10-10-10.ec2.internal
to the long form internal hostname

vi /etc/qpidd.conf
Modify
ssl-cert-name=ip-10-10-10-10.ec2.internal
to the long form internal hostname

restorecon -R /etc/qpid/pki/
chmod +r /etc/qpid/pki/client_db/* /etc/qpid/pki/server_db/*
service qpidd restart
service mcollective restart
