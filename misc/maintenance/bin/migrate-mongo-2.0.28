#!/usr/bin/env oo-ruby
require 'rubygems'
$:.unshift('/var/www/openshift/broker')
require 'config/environment'

begin
  db = OpenShift::DataStore.db(:primary)

  filter = {}
  update_query = {'$set' => {'upgrade_in_progress' => true}}
  db["applications"].update(filter, update_query, { :multi => true })

rescue Exception => e
  puts e.message
  puts e.backtrace
  exit 1
end
puts "Migration Done!"
