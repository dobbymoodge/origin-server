#!/usr/bin/env python

#
# Usage:
#   ./find_by_email account_list.txt
# or
#   cat account_list.txt | ./find_by_email
#
# Lookup accounts based on email addresses
#

import os
import sys
import fileinput
import logging
logging.basicConfig(level=logging.CRITICAL)

try:
    from suds.client import Client
    from suds import WebFault
except:
    print "Error: Requires python-suds to be installed"
    print "Take a look at https://fedorahosted.org/suds/"
    sys.exit()

#
# Configuration data - you might need to change thse values
#

# The IT web service URL to access
webqa_url = 'http://proxyjavavip.web.qa.ext.intdev.redhat.com/svc/UserService/1?wsdl'

#
# The program - no changes needed below this point
#
user = Client(webqa_url)

# Read in the emails to check from a file or stdin
emails = []
for line in fileinput.input():
    emails.append(line.rstrip().lstrip())

for email in emails:
    result = user.service.findByEmail(email)
    if result:
      print email + ":"
      for user in result:
        print "  " + user.login
